extends _layout
block additional_styles
    title #{company.data.name}
    link(rel='stylesheet', href='../css/company.css')
    link(rel='stylesheet', href='../libs/jquery-ui/themes/smoothness/jquery-ui.min.css')
    script(src='../libs/jquery/dist/jquery.min.js')
    script(src='../libs/jquery-ui/jquery-ui.min.js')
    link(rel='stylesheet', href='../libs/fancybox/source/jquery.fancybox.css')
block content
    div(ng-controller='Company',ng-init="stocks= #{JSON.stringify(stocks)}")
        .container-fluid
            .row
                .header
                    .col-md-6
                        img#avatar(src='http://ec2-54-200-218-253.us-west-2.compute.amazonaws.com:8080#{company.data.logo}', alt='Brand')
                        span#company_name #{company.data.name}
                    .col-md-6
                        a(href="/logout")#logout.btn.btn-default Выйти
        .container-fluid
            .row
                .col-md-1
                    .menu
                        ul
                            a(href='main.html')
                                li
                                    i.fa.fa-home
                            br
                            li
                                i.fa.fa-file
                            br
                            li
                                i.fa.fa-bar-chart
                .col-md-7
                    .stats
                        h4 Статистика
                        #charts
                .col-md-4
                    .stock_part
                        .stocks_head
                            h4 Акции
                            i.fa(ng-class="{' fa-sort-alpha-desc': isDown('startDate'),\
              'fa-sort-alpha-asc': isUp('startDate')}")
                            span(ng-click="sort('startDate')")
                                | Дата
                                i.fa(ng-class="{'fa-chevron-down': isDown('startDate'),\
                'fa-chevron-up': isUp('startDate')}")
                            input.form-control(type='text', placeholder='Поиск акции...', ng-model='stock_name')
                        .stocks
                            .stock(ng-repeat='stock in stocks | filter:{name:stock_name} | orderBy:sortField:reverse ', class='{{stock.id}}', style='background: url(http://ec2-54-200-218-253.us-west-2.compute.amazonaws.com:8080{{stock.logo}})', data-name='{{stock.name}}', data-description='{{stock.description}}', data-path='{{stock.logo}}', data-startdate='{{stock.startDate}}', data-enddate='{{stock.endDate}}', data-id='{{stock.id}}'
                            ng-click='go("/stockinfo/",stock.id)')
                                p.stock_header(ng-click='go("/stockinfo/",stock.id)') {{stock.name}}
                                a.fancybox.edit_btn(href='#edit', ng-click='update(stock.id); ', title='Быстрое редактирование')
                                    i.fa.fa-pencil-square-o
                                a.remove(ng-click='remove(stock.id);  $event.stopPropagation(); ', title='Удаление акции')
                                    i.fa.fa-times
                                p.stock_descr {{stock.description}}
                                .date_wrapper
                                    | {{stock.startDate | date:"dd.MM.yyyy"}} - {{stock.endDate | date:"dd.MM.yyyy"}}
                        a.down_arrow.fancybox(href='#stock')
                            i.fa.fa-plus-circle
        form#stock(ng-submit='add()', name='stock', enctype='multipart/form-data')
            h4 Создание акции
            input.form-control(type='text', name='name', placeholder='Заголовок')
            textarea#description.form-control(name='description', cols='30', rows='7', placeholder='Текст акции')
            input.form-control(name='logo', type='file')
            include  includes/categories
            input.form-control.date(name='startDate', type='text', placeholder='Дата начала')
            input.form-control.date(name='endDate', type='text', placeholder='Дата окончания')
            button.btn.btn-primary(type='submit') Добавить
        form#edit
            h4 Редактирование акции
            input.form-control(type='text', name='name', placeholder='Заголовок')
            textarea.form-control(name='description', cols='30', rows='7', placeholder='Текст акции')
            input.form-control(name='logo', type='file')
            include  includes/categories
            input.form-control.date(name='startDate', type='text', placeholder='Дата начала')
            input.form-control.date(name='endDate', type='text', placeholder='Дата окончания')
            button.btn.btn-primary(type='submit') Сохранить
block additional_scripts
    script(src='../libs/angular/angular.min.js')
    script(src='../libs/Chart.js/Chart.js')
    script(src='../libs/fancybox/source/jquery.fancybox.js')
    script(src='../libs/fancybox/source/jquery.fancybox.pack.js')
    script(src='../js/controllers/company.js')
    script(src='../js/Error.js')
    script(src='../js/Visualizer.js')
    script(src="../js/Stats.js")
    script(src="../js/categories.js")
    script.
        var stats_data =!{JSON.stringify(stats)}
        var users_data =!{JSON.stringify(users)}
        var all_categories =!{JSON.stringify(categories)}
        var stats_obj = Stats.getByType(stats_data);
        var users_obj = Stats.getByType(users_data);

        var GraphicF = Visualizer.getByType(stats_data.type);
        var GraphicS = Visualizer.getByType(users_data.type);

        new GraphicF(stats_obj).createCanvas(600, 200, 'Общее количество добавленных пользователями акций').appendTo('charts');

        new GraphicS(users_obj).createCanvas(300, 200, 'Количество пользователей по каждой акции').appendTo('charts');
